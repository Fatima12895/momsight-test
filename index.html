<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momsight | å¦³çš„è‚²å…’æ™‚å…‰å°èˆª</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* å®šç¾©æˆ‘å€‘è¨­è¨ˆçš„è«è˜­è¿ªæš–è‰²ç³» */
        :root {
            --color-warm-pink: #F8E1E1; /* èˆ’ç·©ç²‰ */
            --color-light-green: #E9EDC9; /* æ™¨æ›¦ç¶  */
            --color-calm-blue: #D8E2DC; /* æ²‰éœè— */
            --color-gold: #D4A373; /* æš–æ²™é‡‘ */
        }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fff9f6; /* è¼•æŸ”çš„ç±³ç™½è‰²åº• */
        }
        .text-accent { color: var(--color-gold); }
        .bg-accent { background-color: var(--color-gold); }
        .btn-primary {
            background-color: var(--color-light-green);
            color: #4a573b;
            transition: all 0.3s;
            box-shadow: 0 4px 6px -1px rgb(212, 163, 115, 0.3);
        }
        .btn-primary:hover {
            background-color: #ccd5ae;
            transform: translateY(-2px);
        }
        .card-shadow { box-shadow: 0 10px 15px -3px rgba(248, 225, 225, 0.5), 0 4px 6px -2px rgba(248, 225, 225, 0.05); }
        .quiz-option {
            background-color: #fff;
            border: 2px solid var(--color-warm-pink);
            transition: all 0.2s;
        }
        .quiz-option:hover {
            background-color: var(--color-warm-pink);
            border-color: var(--color-gold);
            transform: scale(1.01);
        }
        /* æ‡¸æµ®çš„æ´‹æ´‹ App æŒ‰éˆ• */
        #yang-yang-fab {
            z-index: 50;
            background-color: #F8E1E1;
            box-shadow: 0 5px 15px rgba(212, 163, 115, 0.6);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        .loading-ring {
            border: 4px solid var(--color-gold);
            border-top-color: transparent;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex flex-col items-center p-0">

    <!-- æ‡¸æµ®çš„ AI æ´‹æ´‹æŒ‰éˆ• (Fab) -->
    <a id="yang-yang-fab" href="#" class="fixed bottom-6 right-6 p-4 rounded-full flex items-center justify-center text-accent text-sm font-bold shadow-lg" onclick="showYangYangModal(event)">
        <span class="text-2xl mr-2">ğŸ§šâ€â™‚ï¸</span>
        æ´‹æ´‹
    </a>

    <!-- ä¸»å…§å®¹å®¹å™¨ -->
    <main id="app-container" class="w-full max-w-lg min-h-screen bg-white rounded-t-3xl shadow-2xl p-6 md:p-8">

        <!-- Header: æ¨™é¡Œèˆ‡ç°¡ä»‹ -->
        <header class="text-center my-6">
            <h1 class="text-4xl font-bold text-accent">Momsight</h1>
            <p class="text-gray-500 mt-2">å¦³çš„è‚²å…’æ™‚å…‰å°èˆªï¼Œçµåˆ MBTI èˆ‡éšæ®µåˆ†æ</p>
        </header>

        <!-- å€å¡Šåˆ‡æ›å®¹å™¨ -->
        <div id="content-area">

            <!-- 1. éšæ®µè¨­å®š (Stage Input) -->
            <section id="stage-input" class="animate-fade-in">
                <h2 class="text-xl font-semibold text-gray-700 mb-6 text-center">é–‹å§‹æ¢ç´¢ï¼šè¼¸å…¥é‡è¦æ—¥æœŸ</h2>
                
                <div class="bg-warm-pink/50 p-6 rounded-2xl mb-6 card-shadow">
                    <p class="text-sm text-gray-600 mb-3">è«‹å‘Šè¨´æˆ‘å€‘ï¼Œå¦³çš„é ç”¢æœŸæˆ–å¯¶å¯¶çš„ç”Ÿæ—¥æ˜¯ï¼Ÿ</p>
                    <input type="date" id="target-date" value="" class="w-full p-3 border-2 border-orange-200 rounded-lg focus:border-accent focus:outline-none">
                    <p id="date-error" class="text-xs text-red-600 mt-2 hidden">è«‹é¸æ“‡ä¸€å€‹æ—¥æœŸæ‰èƒ½é–‹å§‹æ¸¬é©—å–”ï¼</p>
                </div>

                <div class="space-y-4">
                    <button onclick="checkStageAndProceed()" class="w-full btn-primary py-4 rounded-2xl font-bold text-lg">
                        ç¢ºèªæ—¥æœŸä¸¦å•Ÿå‹•æ¸¬é©—
                    </button>
                </div>
            </section>

            <!-- 2. æ¸¬é©—å€ (Quiz) -->
            <section id="quiz-section" class="hidden animate-fade-in">
                <div class="mb-6 text-center">
                    <div class="h-1 w-full bg-gray-100 rounded-full">
                        <div id="quiz-progress" class="h-1 bg-accent rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">å•é¡Œ <span id="current-question-index">1</span> / <span id="total-questions">12</span></p>
                </div>
                
                <div id="quiz-card" class="bg-white p-6 rounded-3xl card-shadow">
                    <h3 id="question-text" class="text-lg font-medium text-gray-800 mb-6 leading-relaxed"></h3>
                    <div id="quiz-options" class="space-y-4">
                        <!-- é¸é …æœƒé€é JS å¡«å…… -->
                    </div>
                </div>
                <!-- ä¿®æ­£: next-button å·²ç¶“åœ¨ JS ä¸­è™•ç†éš±è—/é¡¯ç¤ºï¼Œé€™è£¡ä¿æŒåŸæœ¬ç‹€æ…‹ -->
                <button id="next-button" onclick="nextQuestion()" class="w-full btn-primary py-3 rounded-2xl font-bold mt-6 hidden">ä¸‹ä¸€é¡Œ</button>
            </section>

            <!-- 3. çµæœé¡¯ç¤ºå€ (Result Dashboard) -->
            <section id="result-section" class="hidden animate-fade-in text-center">
                <div class="inline-block p-4 bg-warm-pink rounded-full mb-4">
                    <span class="text-4xl">ğŸ‘‘</span>
                </div>
                <h3 class="text-gray-500 text-sm tracking-widest uppercase mb-2">å¦³çš„åª½å’ªåŸå‹</h3>
                <h2 id="mom-type-title" class="text-3xl font-bold text-accent mb-4"></h2>
                
                <!-- éšæ®µç‹€æ…‹ -->
                <p id="stage-status" class="text-sm text-gray-600 mb-6 py-1 px-3 bg-calm-blue/30 inline-block rounded-full"></p>

                <!-- æ ¸å¿ƒæé†’å¡ç‰‡ -->
                <div class="bg-warm-pink p-6 rounded-2xl text-left mb-6 card-shadow">
                    <h4 class="text-lg font-semibold text-accent mb-3">çµ¦ [åª½å’ªé¡å‹] å¦³çš„è©±ï¼š</h4>
                    <p class="text-gray-700 leading-relaxed" id="mom-reminder"></p>
                </div>

                <!-- æ´‹æ´‹èˆ‡éšŠå‹è¡Œå‹•å€ -->
                <div class="space-y-6">
                    <!-- æ´‹æ´‹ç™‚ç™’è™•æ–¹ -->
                    <div class="bg-light-green p-4 rounded-xl text-left">
                        <p class="text-xs text-gray-600 font-bold mb-2">ğŸ§šâ€â™‚ï¸ æ´‹æ´‹çš„ç™‚ç™’è™•æ–¹</p>
                        <p class="text-gray-700 font-medium mb-3" id="yangyang-tip"></p>
                        <!-- #yangyang-link å·²ç¶“é€é JS ä¿®æ­£ç‚ºæŒ‡å‘ Line@ å¸³è™Ÿ -->
                        <a id="yangyang-link" href="#" target="_blank" class="inline-flex items-center text-sm font-bold text-accent hover:underline">
                            é»æ“Šé–‹å•Ÿæ´‹æ´‹ App é ˜å–è™•æ–¹ â†’
                        </a>
                    </div>
                    
                    <!-- éšŠå‹æ±‚æ•‘å¡ -->
                    <button onclick="showSosCard()" class="w-full btn-primary py-4 rounded-2xl font-bold shadow-lg">
                        å‚³é€ã€ŒéšŠå‹æ‡‰æ´æŒ‡ä»¤ã€çµ¦å…ˆç”Ÿ
                    </button>
                </div>
            </section>

        </div>
    </main>

    <!-- Modal: æ´‹æ´‹ App ä¸‹è¼‰æé†’ -->
    <div id="yangyang-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm text-center">
            <div class="text-4xl mb-4">â˜€ï¸</div>
            <h3 class="text-xl font-bold text-accent mb-3">æ´‹æ´‹ - å¦³çš„å¿ƒç†å°ä¼´ä¾¶</h3>
            <p class="text-gray-600 mb-6">æ´‹æ´‹ App å°ˆç‚ºåª½å’ªè¨­è¨ˆï¼Œæä¾› 24/7 å‚¾è½æœå‹™ï¼Œçµ•ä¸è©•åˆ¤ã€‚ç•¶å£“åŠ›å¤§åˆ°ç„¡äººäº†è§£æ™‚ï¼Œè«‹éš¨æ™‚æ‰¾å¥¹ã€‚</p>
            <div class="space-y-3">
                <!-- ä¿®æ­£ iOS é€£çµ -->
                <a href="https://apps.apple.com/tw/app/herehear-3d%E8%99%9B%E6%93%AC%E7%99%82%E7%99%92%E5%B8%AB%E6%B4%8B%E6%B4%8B/id6472772767" target="_blank" class="w-full block py-3 bg-gray-800 text-white rounded-xl font-bold hover:bg-gray-700">App Store ä¸‹è¼‰ (iOS)</a>
                <!-- ä¿®æ­£ Android é€£çµ -->
                <a href="https://play.google.com/store/apps/details?id=com.BambooTechnology.HereHearaAndroid&hl=zh&pli=1" target="_blank" class="w-full block py-3 btn-primary rounded-xl font-bold">Google Play ä¸‹è¼‰ (Android)</a>
                <button onclick="closeYangYangModal()" class="w-full text-sm text-gray-500 mt-2 hover:underline">æš«æ™‚ä¸ç”¨ï¼Œè¬è¬</button>
            </div>
        </div>
    </div>

    <!-- Modal: éšŠå‹æ±‚æ•‘å¡ -->
    <div id="sos-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm text-center">
            <h3 class="text-xl font-bold text-accent mb-3">ğŸš¨ éšŠå‹æ‡‰æ´æŒ‡ä»¤</h3>
            <div id="sos-card-content" class="bg-warm-pink p-5 rounded-xl mb-4 text-left">
                <!-- å…§å®¹æœƒé€é JS å¡«å…… -->
            </div>
            <p class="text-xs text-gray-500 mb-4">ï¼ˆé•·æŒ‰å¡ç‰‡å…§å®¹è¤‡è£½æˆ–åˆ†äº«åˆ° Lineï¼‰</p>
            <button id="copy-sos-btn" class="w-full py-3 bg-accent text-white rounded-xl font-bold hover:bg-orange-600 mb-2">ä¸€éµè¤‡è£½æŒ‡ä»¤</button>
            <button onclick="closeSosModal()" class="w-full text-sm text-gray-500 mt-2 hover:underline">é—œé–‰</button>
        </div>
    </div>

    <script>
        // å…¨å±€ç‹€æ…‹ç®¡ç†
        let userMbti = '';
        let currentStage = {};
        let currentQuestion = 0;
        let scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };

        // --- æ•¸æ“šçµæ§‹ï¼š16 å‹äººæ ¼ + éšæ®µæ–‡æ¡ˆ (ç°¡åŒ–ç‰ˆ) ---
        // stageCode: pre_1 (æ‡·å­•åˆæœŸ), pre_2 (ä¸­æœŸ), pre_3 (å¾ŒæœŸ), post_1 (ç”¢å¾Œ3M)
        
        // ä¿®æ­£éŒ¯èª¤ï¼šå°‡åŸºç¤æ•¸æ“šæå–å‡ºä¾†ï¼Œè§£æ±º ReferenceError
        const INFJ_BASE = {
            pre_1: { title: "éˆé­‚ç¯‰å¤¢å®¶", reminder: "æƒ…ç·’æ³¢å‹•æ˜¯æ­£å¸¸çš„ã€‚åˆ¥ç„¦æ…®ï¼Œå¦³çš„ç›´è¦ºæ­£åœ¨å¼•å°å¦³ã€‚", yangyang: "INFJ_BREATHING", sos: "æŠ±æŠ±å¥¹ 30 ç§’ï¼Œå®‰éœåœ°è½å¥¹èªªèªªä»Šå¤©çš„å¿ƒæƒ…ã€‚" },
            post_1: { title: "éˆé­‚å°èˆªå“¡åª½å’ª", reminder: "å¦³çš„æ•æ„Ÿæ˜¯å¤©è³¦ï¼Œä½†è«‹ä¸è¦éåº¦å¸æ”¶è² èƒ½é‡ï¼Œè¨˜å¾—å…ˆç…§é¡§å¥½è‡ªå·±ã€‚", yangyang: "INFJ_MEDITATION", sos: "è®“å¥¹å®‰éœç¨è™• 1 å°æ™‚ï¼Œä¸è¦æ‰“æ“¾å¥¹ï¼Œä¸¦å‘Šè¨´å¥¹å·²ç¶“åšå¾—å¾ˆå¥½ã€‚" }
        };
        const ISTJ_BASE = {
            pre_1: { title: "ç²¾å¯†æ•¸æ“šå®¶", reminder: "åœæ­¢æœå°‹ï¼éå¤šçš„ç¦å¿Œè³‡è¨Šåªæœƒå¢åŠ ç„¦æ…®ï¼Œä¿¡ä»»å¦³çš„èº«é«”ã€‚", yangyang: "ISTJ_LOGIC_RESET", sos: "æª¢æŸ¥å¾…è¾¦æ¸…å–®ï¼Œä¸¦ä¸»å‹•å®Œæˆæœ€é›£çš„ä¸€é …å®¶å‹™ã€‚" },
            post_1: { title: "ç²¾å¯†æ•¸æ“šåª½å’ª", reminder: "å¯¶å¯¶çš„ä½œæ¯è¡¨ä¸æ˜¯å¦³çš„ KPIã€‚æ”¾ä¸‹ä¸€ä»¶å®¶å‹™ï¼Œå…è¨±æ··äº‚çš„å­˜åœ¨ã€‚", yangyang: "ISTJ_DECOMPRESS", sos: "æ¥ç®¡æ‰€æœ‰å®¶å‹™ 2 å°æ™‚ï¼Œè®“å¥¹å¾¹åº•æ–·é›»ä¼‘æ¯ã€‚" }
        };
        const ENTP_BASE = {
            pre_1: { title: "å‰µæ„ç­–åŠƒå®¶", reminder: "é›–ç„¶ç¾åœ¨æ­¥èª¿æ…¢äº†ï¼Œä½†é€™æ˜¯å¦³è¨­è¨ˆå®Œç¾è‚²å…’æ³•å‰çš„æ€è€ƒæœŸï¼Œç›¡æƒ…ç™¼æ®å‰µæ„ã€‚", yangyang: "ENTP_BRAINSTORM", sos: "é™ªå¥¹çœ‹ä¸€é›†è·Ÿè‚²å…’å®Œå…¨ç„¡é—œçš„ç¡¬æ ¸ç§‘æŠ€æˆ–æ­·å²åŠ‡ã€‚" },
            post_1: { title: "æ‰“ç ´å¸¸è¦åª½å’ª", reminder: "å¦³çš„éˆæ´»æ˜¯æ‡‰å°å«©å¬°æœ€å¼·çš„æ­¦å™¨ã€‚èª°èªªä¸€å®šè¦æŒ‰ç…§å‚³çµ±æ–¹å¼åšï¼Ÿå¦³å¯ä»¥ç™¼æ˜è‡ªå·±çš„è‚²å…’æ³•ï¼", yangyang: "ENTP_GAMIFY_CLEANING", sos: "ä¸»å‹•å¸¶å¯¶å¯¶å‡ºé–€ 2 å°æ™‚ï¼Œè®“å¥¹ç¨è‡ªäº«å—ç¾é£Ÿã€‚" }
        };
        const ESFP_BASE = {
            pre_1: { title: "æ´»åœ¨ç•¶ä¸‹å®¶", reminder: "å­•åå¾ˆé›£å—ï¼Œä½†è«‹ç›¸ä¿¡å¾ˆå¿«å°±æœƒéå»ã€‚ç¾åœ¨èƒ½ä¼‘æ¯å°±ä¼‘æ¯ï¼Œä¸è¦æœ‰è² ç½ªæ„Ÿã€‚", yangyang: "ESFP_LIGHT_STRETCHING", sos: "ç‚ºå¥¹æº–å‚™ä¸€å€‹æ¼‚äº®çš„ä¸‹åˆèŒ¶é»å¿ƒï¼Œä¸¦æ’­æ”¾ç†±é¬§çš„éŸ³æ¨‚ã€‚" },
            post_1: { title: "æ´¾å°æ ¸å¿ƒåª½å’ª", reminder: "æœ€æ£’çš„æ´¾å°å°±åœ¨å¦³æ‡·è£¡ï¼Œå¦³æ˜¯å¯¶å¯¶å”¯ä¸€çš„è¶…ç´šå·¨æ˜Ÿã€‚äº«å—é€™ä¸€åˆ»èˆ‡ä»–çš„çœ¼ç¥å…±èˆã€‚", yangyang: "ESFP_ENERGIZE", sos: "ç‚ºå¥¹è¦åŠƒä¸€å€‹ 15 åˆ†é˜çš„çŸ­æš«ã€åˆºæ¿€çš„æˆ¶å¤–æ´»å‹•ã€‚" }
        };

        const momDatabase = {
            // E/I, S/N, T/F, J/P
            INFJ: INFJ_BASE,
            ISTJ: ISTJ_BASE,
            ENTP: ENTP_BASE,
            ESFP: ESFP_BASE,
            // ç”±æ–¼ç¯‡å¹…é™åˆ¶ï¼Œå…¶ä»– 12 ç¨®äººæ ¼ä½¿ç”¨å·²å®šç¾©çš„æ•¸æ“šä½œç‚ºå±•ç¤º
            INFP:  { ...INFJ_BASE }, ENFJ:  { ...INFJ_BASE }, ENFP:  { ...INFJ_BASE },
            INTJ:  { ...ISTJ_BASE }, INTP:  { ...ISTJ_BASE }, ENTJ:  { ...ISTJ_BASE },
            ISFJ:  { ...ESFP_BASE }, ESTJ:  { ...ESFP_BASE }, ESTP:  { ...ESFP_BASE },
            ISFP:  { ...ENTP_BASE }, ISTP:  { ...ENTP_BASE },
        };
        
        // --- å¿ƒç†æ¸¬é©—é¡Œç›® (12é¡Œ) ---
        // æ ¼å¼: Q, å±¬æ€§1 (é¸é …A), å±¬æ€§2 (é¸é …B)
        const quizQuestions = [
            // E vs I (èƒ½é‡ä¾†æº)
            { Q: "1. å¥½ä¸å®¹æ˜“æŠŠå¯¶å¯¶å“„ç¡äº†ï¼Œé€™çè²´çš„ 15 åˆ†é˜å¦³æœƒï¼Ÿ", A: "äº«å—çµ•å°çš„å®‰éœï¼Œä¸æƒ³è·Ÿä»»ä½•äººèªªè©±ã€‚", B: "å‚³è¨Šæ¯çµ¦æœ‹å‹ç™¼ç‰¢é¨·ï¼Œæˆ–å»åª½åª½ç¤¾ç¾¤çœ‹è‚²å…’è¶£äº‹ã€‚", TypeA: 'I', TypeB: 'E' },
            { Q: "2. å¸¶å¯¶å¯¶å‡ºé–€æ•£æ­¥æ™‚ï¼Œå¦‚æœé‡åˆ°é„°å±…ç†±æƒ…æ­è¨•èŠå¤©ï¼š", A: "ç¦®è²Œå¾®ç¬‘ä½†å…§å¿ƒå¶å–Šï¼šã€Œæˆ‘åªæƒ³è¶•å¿«èµ°é–‹...ã€", B: "é›–ç„¶æœ‰é»ç´¯ï¼Œä½†è·Ÿå¤§äººèŠå¤©çš„æ„Ÿè¦ºçœŸå¥½ï¼Œé›»åŠ›è£œå› 20%ï¼", TypeA: 'I', TypeB: 'E' },
            { Q: "3. é—œæ–¼å­•æœŸæˆ–ç”¢å¾Œçš„æ´»å‹•è¦åŠƒï¼Œå¦³å‚¾å‘ï¼Ÿ", A: "è¦åŠƒä¸€å€‹åªæœ‰å®¶äººæˆ–éšŠå‹åƒèˆ‡çš„ç§å¯†æ´»å‹•ã€‚", B: "èˆ‰è¾¦ä¸€å€‹å¤§å‹æ´¾å°ï¼Œèˆ‡å¤§å®¶åˆ†äº«é€™ä»½å–œæ‚…ã€‚", TypeA: 'I', TypeB: 'E' },

            // S vs N (è¨Šæ¯æ¥æ”¶)
            { Q: "4. åœ¨è²·å¬°å…’ç”¨å“ï¼ˆå¦‚æ¨è»Šï¼‰æ™‚ï¼Œå¦³æœ€åœ¨æ„çš„æ˜¯ï¼Ÿ", A: "å¯¦æ¸¬æ•¸æ“šï¼šé¿éœ‡å¹¾å…¬åˆ†ã€æ”¶ç´å¹¾ç§’ã€è€é‡å¹¾å…¬æ–¤ï¼Œæ•¸æ“šæœƒèªªè©±ã€‚", B: "æ•´é«”æ°›åœï¼šå®ƒçš„è¨­è¨ˆæ„Ÿã€å“ç‰Œç†å¿µï¼Œä»¥åŠæ¨è‘—å®ƒæ•£æ­¥æ™‚çš„æ„Ÿè¦ºã€‚", TypeA: 'S', TypeB: 'N' },
            { Q: "5. é—œæ–¼ã€Œè‚²å…’å°ˆå®¶çš„å»ºè­°ã€ï¼Œå¦³é€šå¸¸æ€éº¼çœ‹ï¼Ÿ", A: "ç…§è‘—æ­¥é©Ÿä¸€æ­¥æ­¥ä¾†ï¼Œé€™äº›å¯¦å‹™ç¶“é©—æ˜¯æœ€ä¿éšªçš„ã€‚", B: "è½è½çœ‹ï¼Œä½†æˆ‘è¦ºå¾—é‚„æ˜¯è¦çœ‹å¯¶å¯¶çš„éˆé­‚è·Ÿæˆ‘å¥‘ä¸å¥‘åˆã€‚", TypeA: 'S', TypeB: 'N' },
            { Q: "6. ç•¶å¯¶å¯¶ç¬¬ä¸€æ¬¡è¸¢å¦³ï¼ˆèƒå‹•ï¼‰æ™‚ï¼Œå¦³è…¦ä¸­è·³å‡ºçš„ç¬¬ä¸€å€‹å¿µé ­ï¼Ÿ", A: "å–”å–”ï¼ä»–åœ¨é€™å€‹ä½ç½®è¸¢ï¼Œä»–ç¾åœ¨çš„åŠ›é‡å¾ˆæœ‰å‹å–”ã€‚", B: "å“‡ï¼ä»–åœ¨è·Ÿæˆ‘æ‰“æ‹›å‘¼è€¶ï¼Œä»–ä»¥å¾Œä¸€å®šæ˜¯ä¸€å€‹å¾ˆæ´»æ½‘çš„å°æ¢éšªå®¶ã€‚", TypeA: 'S', TypeB: 'N' },

            // T vs F (åˆ¤æ–·æº–å‰‡)
            { Q: "7. å¯¶å¯¶å› ç‚ºä¸æ˜åŸå› å¤§å“­ä¸æ­¢ï¼Œå¦³ç•¶ä¸‹çš„å…§å¿ƒåæ‡‰ï¼Ÿ", A: "åˆ°åº•æ˜¯å“ªè£¡å‡ºå•é¡Œï¼Ÿå‰›é¤µéå¥¶ã€æ›éå°¿å¸ƒï¼Œé›£é“æ˜¯å¤ªç†±äº†ï¼Ÿï¼ˆDebug æ¨¡å¼ï¼‰", B: "å¤©å•Šï¼Œä»–ä¸€å®šå¾ˆé›£å—ï¼Œæˆ‘çš„å¿ƒéƒ½ç¢äº†ï¼Œå¥½æƒ³è¶•å¿«æŠ±ç·Šä»–ã€‚", TypeA: 'T', TypeB: 'F' },
            { Q: "8. è€å…¬è©¦åœ–å¹«å¿™ç…§é¡§ï¼Œä½†å‹•ä½œç¬¨æ‰‹ç¬¨è…³æ™‚ï¼Œå¦³æœƒï¼Ÿ", A: "æŒ‡å‡ºä»–çš„éŒ¯èª¤ï¼šã€Œå¥¶ç“¶ä¸æ‡‰è©²é€™æ¨£æ‹¿ï¼Œé€™æ¨£æœƒé€²ç©ºæ°£ã€‚ã€", B: "é›–ç„¶å¾ˆæƒ³ç³¾æ­£ï¼Œä½†çœ‹ä»–é€™éº¼åŠªåŠ›ï¼Œé‚„æ˜¯å…ˆèª‡çä»–ï¼šã€Œè¬è¬ä½ é€™éº¼ç”¨å¿ƒå¹«å¿™ã€‚ã€", TypeA: 'T', TypeB: 'F' },
            { Q: "9. é—œæ–¼ã€Œæ•™é¤Šå°å­©ã€ï¼Œå¦³èªç‚ºæœ€é‡è¦çš„ä¸€é»æ˜¯ï¼Ÿ", A: "åŸ¹é¤Šä»–ç¨ç«‹è§£æ±ºå•é¡Œçš„èƒ½åŠ›ï¼Œæˆç‚ºä¸€å€‹æœ‰é‚è¼¯çš„äººã€‚", B: "è®“ä»–æ„Ÿå—åˆ°æ»¿æ»¿çš„æ„›èˆ‡å®‰å…¨æ„Ÿï¼Œæˆç‚ºä¸€å€‹æº«æš–çš„äººã€‚", TypeA: 'T', TypeB: 'F' },

            // J vs P (ç”Ÿæ´»æ¨¡å¼)
            { Q: "10. å¦³çš„ã€Œå¾…ç”¢åŒ…ã€æº–å‚™ç‹€æ³é€šå¸¸æ˜¯ï¼Ÿ", A: "æ‡·å­•ä¸ƒå€‹æœˆå°±åˆ—å¥½è¡¨æ ¼ï¼Œå…«å€‹æœˆå°±å·²ç¶“æ•´é½Šæ”¶åœ¨é–€å£ã€‚", B: "å¿«ç”Ÿäº†æ‰é–‹å§‹ç·Šå¼µï¼šã€Œå–”å°ï¼Œæˆ‘è¦æ‹¿é‚£å€‹...é‚„æœ‰é‚£å€‹...ã€", TypeA: 'J', TypeB: 'P' },
            { Q: "11. å¯¶å¯¶ä»Šå¤©çªç„¶ä¸ç¡åˆè¦ºï¼Œæ‰“äº‚äº†å¦³åŸè¨‚çš„è¨ˆç•«ï¼š", A: "æ„Ÿåˆ°éå¸¸ç„¦æ…®èˆ‡ç…©èºï¼Œè¦ºå¾—æ•´å¤©çš„ç¯€å¥éƒ½æ¯€äº†ã€‚", B: "æ²’é—œä¿‚ï¼Œé‚£å°±ç¾åœ¨å¸¶ä»–å»å…¬åœ’èµ°èµ°å§ï¼Œè¨ˆç•«éš¨æ™‚èƒ½æ”¹ã€‚", TypeA: 'J', TypeB: 'P' },
            { Q: "12. é—œæ–¼å®¶è£¡çš„ã€Œè‚²å…’ç’°å¢ƒã€ï¼Œå¦³çš„è¦æ±‚æ˜¯ï¼Ÿ", A: "æ±è¥¿ä¸€å®šè¦æ­¸ä½ï¼Œå¥¶ç²‰ç½ã€å°¿å¸ƒè¢‹éƒ½æœ‰å°ˆå±¬çš„åº§æ¨™ã€‚", B: "éš¨èˆˆå°±å¥½ï¼Œç”Ÿæ´»æ„Ÿé‡ä¸€é»ä¹Ÿæ²’é—œä¿‚ï¼Œé‡é»æ˜¯å¤§å®¶éƒ½é–‹å¿ƒã€‚", TypeA: 'J', TypeB: 'P' },
        ];

        // --- éšæ®µå®šç¾© (7 éšæ®µ) ---
        const TIME_STAGES = {
            pre_1: { min: -280, max: -190, label: "æ‡·å­•åˆæœŸ (1-3å€‹æœˆ)", code: "pre_1" },
            pre_2: { min: -189, max: -90,  label: "æ‡·å­•ä¸­æœŸ (4-6å€‹æœˆ)", code: "pre_2" },
            pre_3: { min: -89,  max: -1,   label: "æ‡·å­•å¾ŒæœŸ (7-9å€‹æœˆ)", code: "pre_3" },
            post_1: { min: 0,    max: 90,   label: "ç”¢å¾Œä¸‰å€‹æœˆ (ç£¨åˆæœŸ)", code: "post_1" },
            post_2: { min: 91,   max: 180,  label: "ç”¢å¾Œå…­å€‹æœˆ (å‰¯é£Ÿå“)", code: "post_2" },
            post_3: { min: 181,  max: 270,  label: "ç”¢å¾Œä¹å€‹æœˆ (çˆ¬è¡ŒæœŸ)", code: "post_3" },
            post_4: { min: 271,  max: 365,  label: "ç”¢å¾Œä¸€å¹´ (é‡ç”ŸæœŸ)",   code: "post_4" }
        };
        
        // --- æ ¸å¿ƒé‚è¼¯å€å¡Š ---

        function toggleSection(sectionId) {
            document.querySelectorAll('#content-area section').forEach(sec => {
                sec.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
        }

        // 1. éšæ®µæª¢æŸ¥èˆ‡è™•ç†
        function calculateMomsStage(targetDateStr) {
            const now = new Date();
            const target = new Date(targetDateStr);
            if (isNaN(target)) return null;

            // Date ç‰©ä»¶åœ¨ä¸åŒç’°å¢ƒä¸‹å¯èƒ½æœƒè§£ææˆ UTC æˆ–æœ¬åœ°æ™‚é–“ï¼Œå°è‡´å·®ä¸€å¤©ã€‚
            // ç‚ºç¢ºä¿è¨ˆç®—æº–ç¢ºï¼Œå°‡æ—¥æœŸè¨­ç‚ºç•¶å¤©åˆå¤œ UTC
            const targetUtc = new Date(target.getUTCFullYear(), target.getUTCMonth(), target.getUTCDate());
            const nowUtc = new Date(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate());
            
            const diffInTime = nowUtc.getTime() - targetUtc.getTime();
            const diffInDays = Math.floor(diffInTime / (1000 * 3600 * 24));


            for (const key in TIME_STAGES) {
                const stage = TIME_STAGES[key];
                if (diffInDays >= stage.min && diffInDays <= stage.max) {
                    return {
                        ...stage,
                        currentDay: diffInDays,
                        message: `ä»Šå¤©æ˜¯å¦³èˆ‡å¯¶å¯¶ç›¸é‡çš„ç¬¬ ${Math.abs(diffInDays)} å¤©`
                    };
                }
            }
            return { label: "è¶…èƒ½åª½å’ªæœŸ", code: "post_future", message: "å¦³å·²ç¶“æ˜¯ä¸€å€‹ç¶“é©—è±å¯Œçš„æˆ°å£«äº†ï¼" };
        }

        function checkStageAndProceed() {
            const dateInput = document.getElementById('target-date').value;
            const errorDiv = document.getElementById('date-error');

            console.log('--- Check Stage and Proceed ---'); // æµç¨‹è¨˜éŒ„
            console.log('Date Input Value:', dateInput); // æµç¨‹è¨˜éŒ„

            if (!dateInput) {
                errorDiv.classList.remove('hidden');
                errorDiv.innerText = 'è«‹é¸æ“‡ä¸€å€‹æ—¥æœŸæ‰èƒ½é–‹å§‹æ¸¬é©—å–”ï¼';
                console.error('ERROR: Date input is empty. Stopping.'); // æµç¨‹è¨˜éŒ„
                return;
            }
            
            errorDiv.classList.add('hidden');

            currentStage = calculateMomsStage(dateInput);
            
            if (currentStage && currentStage.code) {
                console.log('Calculated Stage:', currentStage); // æµç¨‹è¨˜éŒ„
                console.log('Date valid. Starting quiz...'); // æµç¨‹è¨˜éŒ„
                startQuiz();
            } else {
                // å¦‚æœæ—¥æœŸé¸æ“‡äº†ï¼Œä½† calculateMomsStage è¿”å› null (ä¾‹å¦‚ target=NaN)
                errorDiv.classList.remove('hidden');
                errorDiv.innerText = 'æ—¥æœŸç„¡æ•ˆï¼Œè«‹é¸æ“‡ä¸€å€‹åˆæ³•çš„æ—¥æœŸã€‚';
                console.error('ERROR: Could not calculate stage. Date might be invalid or calculation failed.');
            }
        }

        // 2. æ¸¬é©—é‚è¼¯
        function startQuiz() {
            console.log('Starting Quiz...'); // æµç¨‹è¨˜éŒ„
            toggleSection('quiz-section');
            console.log('Section toggled to quiz-section.'); // æµç¨‹è¨˜éŒ„
            currentQuestion = 0;
            scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            renderQuestion();
        }

        function renderQuestion() {
            if (currentQuestion >= quizQuestions.length) {
                calculateMBTI();
                return;
            }

            const qData = quizQuestions[currentQuestion];
            document.getElementById('question-text').innerText = qData.Q;
            document.getElementById('current-question-index').innerText = currentQuestion + 1;
            document.getElementById('total-questions').innerText = quizQuestions.length;
            // é€²åº¦æ¢é¡¯ç¤ºå·²å®Œæˆçš„å•é¡Œæ¯”ä¾‹
            document.getElementById('quiz-progress').style.width = `${((currentQuestion) / quizQuestions.length) * 100}%`; 

            const optionsDiv = document.getElementById('quiz-options');
            optionsDiv.innerHTML = '';

            // éš¨æ©Ÿæ’åˆ—é¸é …ï¼Œé˜²æ­¢ä½œç­”åè¦‹
            const options = [
                { text: qData.A, type: qData.TypeA },
                { text: qData.B, type: qData.TypeB }
            ].sort(() => Math.random() - 0.5);

            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'quiz-option w-full p-4 rounded-xl text-gray-700 text-left font-medium';
                button.innerText = option.text;
                button.onclick = () => selectAnswer(option.type);
                optionsDiv.appendChild(button);
            });
        }

        function selectAnswer(type) {
            scores[type]++;
            currentQuestion++;
            renderQuestion();
        }

        function calculateMBTI() {
            const M1 = scores.E > scores.I ? 'E' : 'I';
            const M2 = scores.S > scores.N ? 'S' : 'N';
            const M3 = scores.T > scores.F ? 'T' : 'F';
            const M4 = scores.J > scores.P ? 'J' : 'P';

            userMbti = M1 + M2 + M3 + M4;
            renderResult();
        }

        // 3. çµæœæ¸²æŸ“
        function renderResult() {
            toggleSection('result-section');
            
            // ç¢ºä¿æœ‰æ‰¾åˆ°æ­£ç¢ºçš„æ•¸æ“šï¼Œå¦å‰‡ä½¿ç”¨ INFJ ä½œç‚º fallback
            const baseData = momDatabase[userMbti] || momDatabase.INFJ;
            const stageCode = currentStage.code in baseData ? currentStage.code : 'post_1'; 
            const userData = baseData[stageCode] || momDatabase.INFJ.post_1; // fallback to INFJ post_1 if missing
            const stageLabel = currentStage.label || TIME_STAGES.post_1.label;
            
            document.getElementById('mom-type-title').innerText = userData.title + ` (${userMbti})`;
            document.getElementById('stage-status').innerText = stageLabel;
            document.getElementById('mom-reminder').innerText = userData.reminder;
            
            // æ´‹æ´‹çš„æé†’æ–‡æ¡ˆ
            document.getElementById('yangyang-tip').innerText = `æ´‹æ´‹å·²ç¶“åœ¨æ‰‹æ©Ÿè£¡ç‚ºå¦³æº–å‚™äº†ã€${userData.yangyang}ã€çš„ç™‚ç™’è™•æ–¹ã€‚`;
            // ä¿®æ­£: å°‡é€£çµæŒ‡å‘ Line@ å¸³è™Ÿï¼Œä½œç‚ºé ˜å–è™•æ–¹çš„è¯ç¹«æ–¹å¼
            document.getElementById('yangyang-link').href = `https://line.me/R/ti/p/@yangyangline`; // è«‹æ›¿æ›ç‚ºå¯¦éš›çš„ Line@ å¸³è™Ÿé€£çµ
            document.getElementById('yangyang-link').target = "_blank"; // ç¢ºä¿åœ¨æ–°åˆ†é é–‹å•Ÿ

            // å°‡çµæœå„²å­˜åˆ°æœ¬åœ°ï¼Œæ¨¡æ“¬æŒä¹…åŒ–
            localStorage.setItem('momsight_mbti', userMbti);
            localStorage.setItem('momsight_birthday', document.getElementById('target-date').value);
        }

        // --- å½ˆçª—é‚è¼¯ ---
        function showYangYangModal(e) {
            e.preventDefault();
            document.getElementById('yangyang-modal').classList.remove('hidden');
        }

        function closeYangYangModal() {
            document.getElementById('yangyang-modal').classList.add('hidden');
        }
        
        function showSosCard() {
            const baseData = momDatabase[userMbti] || momDatabase.INFJ;
            const stageCode = currentStage.code in baseData ? currentStage.code : 'post_1';
            const userData = baseData[stageCode] || momDatabase.INFJ.post_1;
            
            const sosCardHtml = `
                <p class="font-bold text-gray-800 mb-2">çµ¦éšŠå‹çš„æ±‚æ•‘æŒ‡ä»¤ï¼š</p>
                <p class="text-sm text-gray-700">ã€Œæˆ‘æ˜¯ ${userData.title} (${userMbti}) åª½å’ªï¼Œæˆ‘ç¾åœ¨çš„é›»é‡å·²ç¶“è€—ç›¡äº†ï¼Œæˆ‘æœ€éœ€è¦çš„æ”¯æ´æ˜¯ï¼š</p>
                <p class="text-lg font-bold text-accent mt-3">${userData.sos}</p>
                <p class="text-sm text-gray-700 mt-3">â€”â€” æ„›å¦³çš„è€å©†ã€</p>
            `;
            document.getElementById('sos-card-content').innerHTML = sosCardHtml;
            document.getElementById('sos-modal').classList.remove('hidden');
            
            document.getElementById('copy-sos-btn').onclick = () => copySosText(userData.sos);
        }

        function closeSosModal() {
            document.getElementById('sos-modal').classList.add('hidden');
        }

        // è¤‡è£½æ–‡æœ¬åˆ°å‰ªè²¼æ¿
        function copySosText(sosText) {
            // ä½¿ç”¨ document.execCommand('copy') ä½œç‚º fallbackï¼Œå› ç‚º navigator.clipboard åœ¨ iframe ä¸­å¯èƒ½å—é™
            const textToCopy = `æˆ‘æ˜¯ ${userMbti} åª½å’ªï¼Œæˆ‘ç¾åœ¨æœ€éœ€è¦çš„æ”¯æ´æ˜¯ï¼š${sosText}`;
            const tempInput = document.createElement('textarea');
            tempInput.value = textToCopy;
            document.body.appendChild(tempInput);
            tempInput.select();
            
            try {
                const successful = document.execCommand('copy');
                const message = successful ? 'è¤‡è£½æˆåŠŸï¼è«‹å‚³çµ¦éšŠå‹ï¼' : 'è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚';
                // ç‚ºäº†é¿å…ä½¿ç”¨ alert()ï¼Œæˆ‘å€‘åœ¨é€™è£¡çŸ­æš«æ”¹è®ŠæŒ‰éˆ•ç‹€æ…‹ä¾†æç¤ºç”¨æˆ¶
                const copyBtn = document.getElementById('copy-sos-btn');
                const originalText = copyBtn.innerText;
                copyBtn.innerText = message;
                setTimeout(() => {
                    copyBtn.innerText = originalText;
                }, 2000);
            } catch (err) {
                console.error('Copy failed:', err);
            }
            document.body.removeChild(tempInput);
        }

        // --- åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            // å˜—è©¦å¾ LocalStorage æ¢å¾©ç”¨æˆ¶ç‹€æ…‹
            const storedMbti = localStorage.getItem('momsight_mbti');
            const storedBirthday = localStorage.getItem('momsight_birthday');
            
            if (storedMbti && storedBirthday) {
                document.getElementById('target-date').value = storedBirthday;
                userMbti = storedMbti;
                currentStage = calculateMomsStage(storedBirthday);
                renderResult();
            } else {
                toggleSection('stage-input');
            }
        });
    </script>
</body>
</html>
